
const Order=function Order(params){const that=this;this.params=params;this.vars={paymentsLabel:document.querySelectorAll('.order__payments_label'),paymentItems:document.querySelectorAll('.order__payment'),groupIconAll:document.querySelectorAll('.order__payments_img'),deliveryPrepaid:document.querySelectorAll('.order__delivery_section.--prepaid'),deliveryDvp:document.querySelectorAll('.order__delivery_section.--dvp'),deliveryGroup:document.querySelectorAll('.order__delivery_group'),deliveryLabelPrepaid:document.querySelectorAll('.headline__name.--prepaid'),deliveryLabelDvp:document.querySelectorAll('.headline__name.--dvp'),buttonSubmit:document.querySelector('.summary__button'),orderForm:document.querySelector('.order'),basketCostUrl:'/ajax/basket-cost.php',summaryWorth:document.querySelector('.summary__calculation_value.--worth'),summaryShipping:document.querySelector('.summary__calculation_value.--shipping'),summaryPaymentcost:document.querySelector('.summary__calculation_value.--paymentcost'),summaryInsurance:document.querySelector('.summary__calculation_value.--insurance'),summaryRebate:document.querySelector('.summary__calculation_value.--rebate'),summaryPrepaidDiscount:document.querySelector('.summary__calculation_value.--prepaid_discount'),summaryBalance:document.querySelector('.summary__calculation_value.--balance'),summaryAdvance:document.querySelector('.summary__calculation_value.--advance'),summaryTotal:document.querySelector('.summary__calculation_value.--total'),orderTimeValue:document.querySelector('.order__time_item.--value'),orderTimeDe:document.querySelector('.order__time_item.--de'),summaryTimeBlock:document.querySelector('.summary__time'),summaryTime:document.querySelectorAll('.summary__delivery_item'),summaryTimeTxt:document.querySelector('.summary__delivery_item.--txt'),summaryTimeValue:document.querySelector('.summary__delivery_item.--value'),summaryTimeDe:document.querySelector('.summary__delivery_item.--de'),summaryTimeHour:document.querySelector('.summary__delivery_item.--hour'),summaryTimeShipping:document.querySelector('.summary__time_item.--shipping'),summaryTimeShippingValue:document.querySelector('.summary__shipping_item.--value'),calendarButton:document.querySelectorAll('.order__time_calendar'),calendarBlockBase:document.querySelector('.order__calendar_block'),calendarBlockBaseDivision:(document.querySelector('input[name="calendar_select_date_division"]'))?document.querySelector('input[name="calendar_select_date_division"]').closest('.order__calendar_block'):'',pointsLabel:document.querySelectorAll('.order__points_label'),giftCardUrl:'/ajax/gift-cards-and-vouchers.php',xpressUrl:'/ajax/sameday.php',xpressButton:document.querySelectorAll('.order__xpress_button'),xpressGroupBase:document.querySelector('.order__delivery.--normal .order__xpress_group')?document.querySelector('.order__delivery.--normal .order__xpress_group').outerHTML:'',insuranceInput:document.querySelector('.order__insruance_checkbox'),servicesSelectBase:document.querySelector('.order__services_select'),servicesSelectBaseDivision:document.querySelector('.order__services_select[name="calendar_services_division"]'),servicesInterval:0,};this.fetchData=async()=>{const dataDelivery=`?delivery=${(document.querySelector('input[name="shipping"]:checked'))?document.querySelector('input[name="shipping"]:checked').value:''}`;const dataPayform=`&payform_id=${(document.querySelector('input[name="payform_id"]:checked'))?document.querySelector('input[name="payform_id"]:checked').value:''}`;const dataShippingPoints=`${(document.querySelector('input[name="shipping_for_points"][value="1"]:checked'))?'&shipping_for_points=1':''}`;const dataInsurance=`${document.querySelector('input[name="add_insurance"]:checked')?'&add_insurance=1':''}`;const dataServices=`${(document.querySelector('select[name="calendar_services"]')&&document.querySelector('select[name="calendar_services"]').value!=='')?`&calendar_services=${document.querySelector('select[name="calendar_services"]').value}`:''}`;const dataServicesPoints=`${document.querySelector('input[name="calendar_services_points"][value="1"]')?'&calendar_services_points=1':''}`;const dataDeliveryDivision=`${document.querySelector('input[name="shipping_division"]:checked')?`&delivery_division=${document.querySelector('input[name="shipping_division"]:checked').value}`:''}`;const dataShippingPointsDivision=`${(document.querySelector('input[name="shipping_for_points_division"][value="1"]:checked'))?'&shipping_for_points_division=1':''}`;const dataServicesDivision=`${(document.querySelector('select[name="calendar_services_division"]')&&document.querySelector('select[name="calendar_services_division"]').value!=='')?`&calendar_services_division=${document.querySelector('select[name="calendar_services_division"]').value}`:''}`;const dataServicesPointsDivision=`${document.querySelector('input[name="calendar_services_points_division"][value="1"]')?'&calendar_services_points_division=1':''}`;const dataFetch=`${dataDelivery}${dataPayform}${dataShippingPoints}${dataInsurance}${dataServices}${dataServicesPoints}${dataDeliveryDivision}${dataShippingPointsDivision}${dataServicesDivision}${dataServicesPointsDivision}`;try{const response=await fetch(`${this.vars.basketCostUrl}${dataFetch}`);const dataJson=await response.json();return dataJson;}catch(error){console.error('AJAX fetchData() Error:',error);return false;}};this.updateCost=async()=>{await this.fetchData().then((costData)=>{costData.products_worth_formatted?that.vars.summaryWorth.innerHTML=costData.products_worth_formatted:that.vars.summaryWorth.parentNode.classList.remove('--active');if(costData.shipping_cost_points){that.vars.summaryShipping.innerHTML=costData.shipping_cost_points+orderTxt.pkt;that.vars.summaryShipping.classList.add('--plus');}else if(costData.shipping_cost_after_rebate>0){that.vars.summaryShipping.innerHTML=costData.shipping_cost_after_rebate_formatted;that.vars.summaryShipping.classList.add('--plus');}else{that.vars.summaryShipping.innerHTML=orderTxt.gratis;that.vars.summaryShipping.classList.remove('--plus');}
if(costData.prepaid_cost&&costData.prepaid_cost>0){that.vars.summaryPaymentcost.innerHTML=costData.prepaid_cost_formatted;that.vars.summaryPaymentcost.parentNode.classList.add('--active');}else{that.vars.summaryPaymentcost.parentNode.classList.remove('--active');}
if(costData.insurance_cost&&costData.insurance_cost>0){that.vars.summaryInsurance.innerHTML=costData.insurance_cost_formatted;that.vars.summaryInsurance.parentNode.classList.add('--active');}else{that.vars.summaryInsurance.parentNode.classList.remove('--active');}
if(costData.total_rebate_without_shipping&&costData.total_rebate_without_shipping>0){that.vars.summaryRebate.innerHTML=costData.total_rebate_without_shipping_formatted;that.vars.summaryRebate.parentNode.classList.add('--active');}else{that.vars.summaryRebate.parentNode.classList.remove('--active');}
if(costData.prepaid_discount&&costData.prepaid_discount>0){that.vars.summaryPrepaidDiscount.innerHTML=costData.prepaid_discount_formatted;that.vars.summaryPrepaidDiscount.parentNode.classList.add('--active');}else{that.vars.summaryPrepaidDiscount.parentNode.classList.remove('--active');}
if(that.vars.summaryBalance){if(costData.payment_amount_from_client_balance&&parseFloat(costData.payment_amount_from_client_balance,10)>0){that.vars.summaryBalance.innerHTML=costData.payment_amount_from_client_balance_formatted;that.vars.summaryBalance.parentNode.classList.add('--active');}else{that.vars.summaryBalance.parentNode.classList.remove('--active');}}
if(that.vars.summaryAdvance){if((that.vars.summaryAdvance.getAttribute('data-dvp')==='true'&&document.querySelector('.--dvp input[name="shipping"]:checked'))||(that.vars.summaryAdvance.getAttribute('data-prepaid')==='true'&&document.querySelector('.--prepaid input[name="shipping"]:checked'))){that.vars.summaryAdvance.parentNode.classList.add('--active');}else{that.vars.summaryAdvance.parentNode.classList.remove('--active');}}
const usesVat=(clientDataUsesVat!=='false'&&app_shop.vars.vat_registered!=='false')?orderTxt.gross:'';if(costData.total_to_pay){that.vars.summaryTotal.childNodes[0].nodeValue=costData.total_to_pay_formatted+usesVat;that.vars.summaryTotal.parentNode.classList.add('--active');}else{that.vars.summaryTotal.parentNode.classList.remove('--active');}});};this.changeLiteral=(value,numerals,wovalue)=>{const t0=value%10;const t1=value%100;const vo=[];if(wovalue!==true)vo.push(value);if(value===1&&numerals[1])vo.push(numerals[1]);else if((value===0||(t0>=0&&t0<=1)||(t0>=5&&t0<=9)||(t1>10&&t1<20))&&numerals[0])vo.push(numerals[0]);else if(((t1<10||t1>20)&&t0>=2&&t0<=4)&&numerals[2])vo.push(numerals[2]);return vo.join(' ');};this.updateDelivery=(delivery)=>{const id=delivery.getAttribute('data-id');const minuteTime=delivery.getAttribute('data-minute');const[days,hours,minutes,name,weeks]=minuteTime.split('#');const dayName=orderTxtShipping[name];const orderDelivery=delivery.closest('.order__delivery');let daysHoursMinutes='';if(days==='1')daysHoursMinutes=days+orderTxt.day;else if(days>0)daysHoursMinutes=days+orderTxt.days;if(hours==='1')daysHoursMinutes+=hours+orderTxt.hour;else if(hours>0)daysHoursMinutes+=hours+orderTxt.hours;if(minutes>0)daysHoursMinutes+=minutes+orderTxt.minutes;delivery.closest('.order__delivery').querySelectorAll('.order__time_item').forEach((el)=>el.classList.remove('--active'));this.vars.summaryTime.forEach((el)=>el.classList.remove('--active'));const shippingTime=this.vars.summaryTimeShippingValue.getAttribute('data-shipping_time');this.vars.summaryTimeShippingValue.innerHTML=orderTxtShipping[shippingTime];if(weeks==='0'&&hours==='0'&&minutes==='0'){if(id==='0-0'||id==='0-1'){orderDelivery.querySelector('.order__time_item.--txt').innerHTML=orderTxt.time_pick4;orderDelivery.querySelector('.order__time_item.--txt').classList.add('--active');this.vars.summaryTimeShipping.classList.remove('--active');}else{orderDelivery.querySelector('.order__time_item.--txt').innerHTML=orderTxt.time_pick5;orderDelivery.querySelector('.order__time_item.--txt').classList.add('--active');this.vars.summaryTimeShipping.classList.add('--active');}
orderDelivery.querySelector('.order__time_item.--value').innerHTML=dayName;orderDelivery.querySelector('.order__time_item.--value').classList.add('--active');orderDelivery.querySelector('.order__time_item.--de').innerHTML=orderTxt.time_pick5de;orderDelivery.querySelector('.order__time_item.--de').classList.add('--active');}else{if(id==='0-0'||id==='0-1'){(days==='0'&&hours==='0'&&minutes==='0')?orderDelivery.querySelector('.order__time_item.--txt').innerHTML=orderTxt.time_pick6:orderDelivery.querySelector('.order__time_item.--txt').innerHTML=orderTxt.time_pick3;this.vars.summaryTimeShipping.classList.remove('--active');}else{orderDelivery.querySelector('.order__time_item.--txt').innerHTML=orderTxt.time_pick1;this.vars.summaryTimeShipping.classList.add('--active');}
orderDelivery.querySelector('.order__time_item.--txt').classList.add('--active');orderDelivery.querySelector('.order__time_item.--value').innerHTML=daysHoursMinutes;orderDelivery.querySelector('.order__time_item.--value').classList.add('--active');}
if(orderDelivery.querySelector('.order__time_item.--txt').classList.contains('--active')){this.vars.summaryTimeTxt.innerHTML=orderDelivery.querySelector('.order__time_item.--txt').innerHTML;this.vars.summaryTimeTxt.classList.add('--active');}
if(orderDelivery.querySelector('.order__time_item.--value').classList.contains('--active')){this.vars.summaryTimeValue.innerHTML=this.vars.orderTimeValue.innerHTML;this.vars.summaryTimeValue.classList.add('--active');}
if(this.vars.orderTimeDe.classList.contains('--active')){this.vars.summaryTimeDe.innerHTML=this.vars.orderTimeDe.innerHTML;this.vars.summaryTimeDe.classList.add('--active');}
if(this.vars.summaryTimeHour.classList.contains('--active')){this.vars.summaryTimeHour.innerHTML=this.vars.summaryTimeHour.innerHTML;this.vars.summaryTimeHour.classList.add('--active');}
this.calendar(delivery);const deliverySameday=delivery.hasAttribute('data-xpress_type')?delivery.getAttribute('data-xpress_type'):'';if(deliverySameday){orderDelivery.querySelector('.order__xpress').classList.add('--active');orderDelivery.querySelector('.order__time').classList.add('--xpress');this.vars.summaryTimeBlock.classList.add('--xpress');}};this.calendar=(delivery)=>{const id=delivery.getAttribute('data-id');const calendar=delivery.getAttribute('data-calendar');const orderDelivery=delivery.closest('.order__delivery');const services=delivery.getAttribute('data-services');if(orderDelivery.classList.contains('--division')){orderDelivery.querySelector('.order__services_select').outerHTML=this.vars.servicesSelectBaseDivision.outerHTML;orderDelivery.querySelector('.order__calendar_block').outerHTML=this.vars.calendarBlockBaseDivision.outerHTML;}else{orderDelivery.querySelector('.order__services_select').outerHTML=this.vars.servicesSelectBase.outerHTML;orderDelivery.querySelector('.order__calendar_block').outerHTML=this.vars.calendarBlockBase.outerHTML;}
orderDelivery.querySelector('.order__calendar_services_points').value=0;if(calendar!=='n'&&calendar!==''&&id!=='0-0'&&id!=='0-1'&&!services){orderDelivery.querySelector('.order__time_calendar').classList.add('--active');orderDelivery.querySelector('.order__select_day').value=1;calendar==='t'?orderDelivery.querySelector('.order__calendar_hour').classList.add('--active'):orderDelivery.querySelector('.order__calendar_hour').classList.remove('--active');(id==='16-0'||id==='16-1')?this.generateDateElement(true,delivery):this.generateDateElement(false,delivery);orderDelivery.querySelector('.order__calendar_services').classList.remove('--active');}else{orderDelivery.querySelector('.order__time_calendar').classList.remove('--active');orderDelivery.querySelector('.order__select_day').value=0;if(services){this.services(delivery);orderDelivery.querySelector('.order__select_day').value=1;}}
orderDelivery.querySelector('.order__hour_input').value='';};this.generateDateElement=(own,delivery,servicesData)=>{const orderDelivery=delivery.closest('.order__delivery');const calendarElements=orderDelivery.querySelectorAll('.order__date');const calendarElement=orderDelivery.querySelector('.order__date:not(.--other)');const calendarElementOther=orderDelivery.querySelector('.order__date.--other');const calendarBlock=orderDelivery.querySelector('.order__calendar_block');const dataOwn=own?calendarBlock.getAttribute('data-own').split(','):false;if(servicesData){orderDelivery.querySelector('.order__calendar').classList.add('--active');orderDelivery.querySelector('.order__calendar_services').classList.remove('--active');orderDelivery.querySelector('.order__calendar_hour').classList.remove('--active');servicesData.services.calendar.forEach((el,index)=>{if(index>0)calendarBlock.insertBefore(calendarElement.cloneNode(true),calendarElementOther);calendarBlock.querySelectorAll('.order__date')[index].querySelector('.order__date_radio').value=`${el.year}-${el.month}-${el.day}`;calendarBlock.querySelectorAll('.order__date')[index].querySelector('.order__date_day').innerHTML=el.day;calendarBlock.querySelectorAll('.order__date')[index].querySelector('.order__date_month').innerHTML=iaical_monthNames2[parseInt(el.month)-1];calendarBlock.querySelectorAll('.order__date')[index].setAttribute('data-index',index);});calendarElementOther.classList.remove('--active');calendarBlock.querySelectorAll('.order__date')[0].querySelector('.order__date_radio').checked=true;this.calendarElementClick(calendarBlock.querySelectorAll('.order__date')[0],servicesData);}else if(own){dataOwn.forEach((el,index)=>{if(index>0)calendarBlock.insertBefore(calendarElement.cloneNode(true),calendarElementOther);calendarBlock.querySelectorAll('.order__date')[index].querySelector('.order__date_radio').value=el;const[,month,day]=dataOwn[index].split('-');calendarBlock.querySelectorAll('.order__date')[index].querySelector('.order__date_day').innerHTML=day;calendarBlock.querySelectorAll('.order__date')[index].querySelector('.order__date_month').innerHTML=iaical_monthNames2[parseInt(month)-1];});calendarElementOther.classList.remove('--active');}else{for(let i=1;i<5;i++){calendarBlock.insertBefore(calendarElement.cloneNode(true),calendarElementOther);}
calendarElementOther.classList.add('--active');this.printDays(delivery);}
const calendarElementNew=orderDelivery.querySelectorAll('.order__date');calendarElementNew.forEach((el)=>{el.querySelector('.order__date_label').addEventListener('click',function paymentsLabelClick(e){e.preventDefault();if(servicesData){that.calendarElementClick(el,servicesData);}else{that.calendarElementClick(el);}});});};this.printDays=(delivery)=>{const orderDelivery=delivery.closest('.order__delivery');const workingDays=JSON.parse(delivery.getAttribute('data-working_days'));const deliveryTime=parseInt(delivery.getAttribute('data-delivery_time'),10);const holiday=(orderDelivery.querySelector('.order__calendar_block').hasAttribute('data-holiday'))?orderDelivery.querySelector('.order__calendar_block').getAttribute('data-holiday').split(','):false;const calendarElement=orderDelivery.querySelectorAll('.order__date:not(.--other)');const calendarElementInput=orderDelivery.querySelectorAll('.order__date_radio');const[year,month,day]=orderDelivery.querySelector('.order__calendar_block').getAttribute('data-calendar').split('-');const date=new Date(parseInt(year,10),parseInt(month,10)-1,parseInt(day,10));date.setDate(date.getDate()+deliveryTime);calendarElement.forEach((el)=>{let dayTmp=date.getDate()<10?`0${date.getDate()}`:date.getDate();let monthTmp=(date.getMonth()+1)<10?`0${date.getMonth()+1}`:date.getMonth()+1;let yearTmp=date.getFullYear();if(holiday&&workingDays.length){while(!workingDays.find((working)=>working===date.getDay())||holiday.find((holidayDay)=>holidayDay===`${yearTmp}-${monthTmp}-${dayTmp}`)){date.setDate(date.getDate()+1);dayTmp=date.getDate()<10?`0${date.getDate()}`:date.getDate();monthTmp=(date.getMonth()+1)<10?`0${date.getMonth()+1}`:date.getMonth()+1;yearTmp=date.getFullYear();}}else if(workingDays.length){while(!workingDays.find((working)=>working===date.getDay())){date.setDate(date.getDate()+1);dayTmp=date.getDate()<10?`0${date.getDate()}`:date.getDate();monthTmp=(date.getMonth()+1)<10?`0${date.getMonth()+1}`:date.getMonth()+1;yearTmp=date.getFullYear();}}
el.querySelector('.order__date_radio').value=`${yearTmp}-${monthTmp}-${dayTmp}`;el.querySelector('.order__date_day').innerHTML=dayTmp;el.querySelector('.order__date_month').innerHTML=iaical_monthNames2[parseInt(monthTmp)-1];date.setDate(date.getDate()+1);});this.datePicker(delivery);};this.datePicker=(delivery)=>{const orderDelivery=delivery.closest('.order__delivery');const workingDays=JSON.parse(delivery.getAttribute('data-working_days'));const deliveryTime=parseInt(delivery.getAttribute('data-delivery_time'),10);const calendarDate=orderDelivery.querySelector('.order__calendar_block').getAttribute('data-calendar');const selectDate=orderDelivery.querySelector('.order__date:first-child .order__date_radio').value;const holiday=(orderDelivery.querySelector('.order__calendar_block').hasAttribute('data-holiday'))?orderDelivery.querySelector('.order__calendar_block').getAttribute('data-holiday').split(','):false;const calendarElement=orderDelivery.querySelectorAll('.order__date:not(.--other)');const[year,month,day]=calendarDate.split('-');const calendarDateFormat=new Date(year,month-1,day);calendarDateFormat.setDate(calendarDateFormat.getDate()+deliveryTime);$(orderDelivery.querySelector('.order__datepicker')).datepicker('destroy');$(orderDelivery.querySelector('.order__datepicker')).datepicker({dateFormat:iaical_dateFormat,dayNamesMin:iaical_daysShort,defaultDate:selectDate,beforeShowDay:function beforeShowDayDatepicker(date){const dayTmp=date.getDate()<10?`0${date.getDate()}`:date.getDate();const monthTmp=(date.getMonth()+1)<10?`0${date.getMonth()+1}`:date.getMonth()+1;const yearTmp=date.getFullYear();if(holiday){for(holidayDay of holiday){if(holidayDay===`${yearTmp}-${monthTmp}-${dayTmp}`)return[false,''];}}
if(workingDays){if(workingDays.indexOf(date.getDay())===-1)return[false,''];}
return[true,''];},minDate:calendarDateFormat,monthNames:iaical_monthNames,nextText:iaical_monthNext,prevText:iaical_monthPrev,onSelect:function onSelectDatepicker(dateText){calendarElement[calendarElement.length-1].querySelector('.order__date_radio').value=dateText;calendarElement[calendarElement.length-1].querySelector('.order__date_day').innerHTML=dateText.split('-')[2];calendarElement[calendarElement.length-1].querySelector('.order__date_month').innerHTML=iaical_monthNames2[parseInt(dateText.split('-')[1])-1];calendarElement[calendarElement.length-1].querySelector('.order__date_radio').checked=true;orderDelivery.querySelector('.order__datepicker').classList.remove('--active');orderDelivery.querySelector('.order__time_item.--value').innerHTML=dateText;that.vars.summaryTimeValue.innerHTML=dateText;},firstDay:iaical_firstDay,});};this.calendarElementClick=(element,servicesData)=>{const orderDelivery=element.closest('.order__delivery');if(orderDelivery.classList.contains('--division')){orderDelivery.querySelector('.order__services_select').outerHTML=this.vars.servicesSelectBaseDivision.outerHTML;}else{orderDelivery.querySelector('.order__services_select').outerHTML=this.vars.servicesSelectBase.outerHTML;}
orderDelivery.querySelectorAll('.order__services_cost').forEach((el)=>el.innerHTML='');orderDelivery.querySelector('.order__calendar_services_points').value=0;orderDelivery.querySelector('.order__hour_input').value='';if(element.classList.contains('--other')){orderDelivery.querySelector('.order__datepicker').classList.toggle('--active');}else{element.querySelector('.order__date_radio').checked=true;orderDelivery.querySelector('.order__time_item.--value').innerHTML=element.querySelector('.order__date_radio').value;this.vars.summaryTimeValue.innerHTML=element.querySelector('.order__date_radio').value;if(servicesData){const index=element.getAttribute('data-index');const servicesSelect=orderDelivery.querySelector('.order__services_select');if(servicesData.services.calendar[index].type==='input'||!servicesData.services.calendar[index].availableServices.length){orderDelivery.querySelector('.order__calendar_hour').classList.add('--active');orderDelivery.querySelector('.order__calendar_services').classList.remove('--active');}else if(servicesData.services.calendar[index].type==='select'){orderDelivery.querySelector('.order__calendar_hour').classList.remove('--active');orderDelivery.querySelector('.order__calendar_services').classList.add('--active');servicesData.services.calendar[index].availableServices.forEach((el)=>{servicesSelect.innerHTML=servicesSelect.innerHTML+`<option value="${el.id}"${el.selectedForPrice&&'selected="selected" '}data-name="${el.name}"data-price="${el.priceFormatted}">${el.name}&nbsp;${el.priceFormatted}</option>`;if(el.pointsEnabled===true){servicesSelect.innerHTML=servicesSelect.innerHTML+`<option value="${el.id}"data-name="${el.name}"data-price="${el.pointCostFormatted}"data-points="${el.pointsEnabled}">${el.name}&nbsp;${el.pointCostFormatted}</option>`;}});const selectOrderServices=new SelectToDropdown({selector:(orderDelivery.classList.contains('--division'))?'.order__services_select.f-select[name="calendar_services_division"]':'.order__services_select.f-select[name="calendar_services"]',afterClickDropdownCallback:(currentClick)=>{element.querySelector('.order__services_cost').innerHTML=currentClick.querySelector('.f-dropdown-item').getAttribute('data-price');if(currentClick.querySelector('.f-dropdown-item').hasAttribute('data-points')){orderDelivery.querySelector('.order__calendar_services_points').value=1;}else{orderDelivery.querySelector('.order__calendar_services_points').value=0;}
that.updateCost();},generateDropdownCallback:(currentDropdown)=>{if(currentDropdown.querySelector('.f-dropdown-item.--selected')!==null){element.querySelector('.order__services_cost').innerHTML=currentDropdown.querySelector('.f-dropdown-item.--selected').getAttribute('data-price');if(currentDropdown.querySelector('.f-dropdown-item.--selected').hasAttribute('data-points')){orderDelivery.querySelector('.order__calendar_services_points').value=1;}else{orderDelivery.querySelector('.order__calendar_services_points').value=0;}
that.updateCost();}}});}else{orderDelivery.querySelector('.order__calendar_hour').classList.remove('--active');orderDelivery.querySelector('.order__calendar_services').classList.remove('--active');}}}};this.changeDelivery=(method)=>{if(method===1){this.vars.deliveryPrepaid.forEach((prepaid)=>prepaid.classList.add('--active'));this.vars.deliveryDvp.forEach((dvp)=>dvp.classList.remove('--active'));this.vars.deliveryLabelPrepaid.forEach((labelPrepaid)=>labelPrepaid.classList.add('--active'));this.vars.deliveryLabelDvp.forEach((labelDvp)=>labelDvp.classList.remove('--active'));}else{this.vars.paymentItems.forEach((payment)=>payment.querySelector('.order__radio').checked=false);this.vars.deliveryPrepaid.forEach((prepaid)=>prepaid.classList.remove('--active'));this.vars.deliveryDvp.forEach((dvp)=>dvp.classList.add('--active'));this.vars.deliveryLabelPrepaid.forEach((labelPrepaid)=>labelPrepaid.classList.remove('--active'));this.vars.deliveryLabelDvp.forEach((labelDvp)=>labelDvp.classList.add('--active'));}
const currentDelivery=document.querySelectorAll('.order__delivery .order__radio_delivery:checked');currentDelivery.forEach((delivery)=>{const orderDelivery=delivery.closest('.order__delivery');const[currentDeliveryValue,currentDeliveryMethod]=delivery.value.split('-');const similarDelivery=orderDelivery.querySelector(`.order__radio_delivery[value="${currentDeliveryValue}-${method}"]`);const orderRadio=orderDelivery.querySelector('.order__delivery_section.--active .order__radio_delivery:not(:disabled)');if(similarDelivery&&!similarDelivery.disabled){similarDelivery.parentNode.click();}else if(currentDeliveryMethod!==method&&orderRadio){orderRadio.parentNode.click();}});};this.pointsDelivery=(pointsLabel)=>{if(pointsLabel.length){pointsLabel.forEach((el)=>{el.classList.remove('--active');el.previousElementSibling.checked=false;});const deliveryInputChecked=pointsLabel[0].closest('.order__delivery').querySelector('.order__radio_delivery:checked');const currentPointsLabel=deliveryInputChecked?deliveryInputChecked.parentNode.querySelectorAll('.order__points_label'):false;if(currentPointsLabel.length){currentPointsLabel.forEach((el)=>{el.classList.add('--active');if(el.parentNode.querySelector('.order__radio_points[value="0"]')){el.parentNode.querySelector('.order__radio_points[value="0"]').checked=true;}});}}
this.updateCost();};this.giftCardDialog=(type)=>{$('body').dialog({content:(type==='gift')?$('.order__giftcard').html():$('.order__voucher').html(),beforeShow:function beforeShowFunction(){$('.form-group .form-control, .f-group .f-control').on('change input focus blur',app_shop.fn.addFocused);if(type==='gift'){document.querySelector('#dialog_wrapper .order__giftcard_button').addEventListener('click',function giftcardButtonClick(e){e.preventDefault();that.giftCardCheck(type,this);});}else{document.querySelector('#dialog_wrapper .order__voucher_button').addEventListener('click',function voucherButtonClick(e){e.preventDefault();that.giftCardCheck(type,this);});}},width:400,});};this.giftCardCheck=(type,button)=>{const allFeedbacks=button.parentNode.parentNode.querySelectorAll('.f-feedback');const inputNumber=button.parentNode.parentNode.querySelector('input[name="voucher_id"]');const inputPin=button.parentNode.parentNode.querySelector('input[name="pin_value"]');const dataFetch=`action=auth&number=${inputNumber.value}${inputPin?`&pin=${inputPin.value}`:''}`;try{fetch(`${this.vars.giftCardUrl}`,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8',},body:dataFetch,}).then((response)=>response.json()).then((data)=>{if(data.errno==='0'){allFeedbacks.forEach((el)=>{el.classList.remove('--required','--error','--success');el.classList.add('--success');});this.vars.orderForm.appendChild(inputNumber.cloneNode(true));if(inputPin)this.vars.orderForm.appendChild(inputPin.cloneNode(true));(type==='gift')?document.getElementById('payform_190').checked=true:document.getElementById('payform_2').checked=true;that.changeDelivery(1);this.vars.orderForm.submit();}else{Alertek.show_alert(data.error);allFeedbacks.forEach((el)=>{el.classList.remove('--required','--error','--success');el.classList.add('--error');});}}).catch((error)=>console.error('AJAX giftCardCheck() Error:',error));}catch(error){console.error('AJAX giftCardCheck() Error:',error);return false;}
return false;};this.xpressCouriers=()=>{const deliveryGroupActive=document.querySelector('input[name="shipping"]:checked').parentNode;const deliveryId=deliveryGroupActive.getAttribute('data-id').split('-')[0];const dataFetch=`?action=getHourOptions&courierId=${deliveryId}`;const xpressGroup=document.querySelector('.order__xpress_group');const xpressAvailable=deliveryGroupActive.closest('.order__delivery').querySelector('.order__xpress_not');const xpressChoice=deliveryGroupActive.closest('.order__delivery').querySelector('.order__xpress_choice');document.getElementById('content').classList.add('load-content');try{fetch(`${this.vars.xpressUrl}${dataFetch}`).then((response)=>response.json()).then((data)=>{document.getElementById('content').classList.remove('load-content');if(data.errno===0){if(data.result.length>0){xpressAvailable.classList.remove('--active');xpressChoice.classList.add('--active');data.result.forEach((el,index)=>{if(index===0){xpressGroup.querySelector('.order__xpress_radio').value=el.id;xpressGroup.querySelector('.order__xpress_radio').id=`sameday_${el.id}`;xpressGroup.querySelector('.order__xpress_label').innerHTML=el.description;xpressGroup.querySelector('.order__xpress_label').setAttribute('for',`sameday_${el.id}`);}else{const xpressGroupClone=xpressGroup.cloneNode(true);xpressGroupClone.querySelector('.order__xpress_radio').value=el.id;xpressGroupClone.querySelector('.order__xpress_radio').id=`sameday_${el.id}`;xpressGroupClone.querySelector('.order__xpress_label').innerHTML=el.description;xpressGroupClone.querySelector('.order__xpress_label').setAttribute('for',`sameday_${el.id}`);that.vars.xpressChoice.appendChild(xpressGroupClone);}});document.querySelector('.order__xpress_group:first-child .order__xpress_radio').checked=true;}else{xpressChoice.classList.remove('--active');xpressAvailable.classList.add('--active');}}else if(data.errno===2){Alertek.show_alert(orderTxt.xpress2);}else if(data.errno===3){Alertek.show_alert(orderTxt.xpress3);}}).catch((error)=>{document.getElementById('content').classList.remove('load-content');console.error('AJAX xpressCouriers() Error:',error)});}catch(error){document.getElementById('content').classList.remove('load-content');console.error('AJAX xpressCouriers() Error:',error);return false;}
return false;};this.services=(delivery)=>{const link=delivery.getAttribute('data-services');document.getElementById('content').classList.add('load-content');try{fetch(link).then((response)=>response.json()).then((data)=>{this.generateDateElement(false,delivery,data);document.getElementById('content').classList.remove('load-content');}).catch((error)=>{console.error('AJAX services() Error:',error);this.vars.servicesInterval+=1;this.servicesError(delivery);});}catch(error){document.getElementById('content').classList.remove('load-content');console.error('AJAX services() Error:',error);return false;}
return false;};this.servicesError=(delivery)=>{if(this.vars.servicesInterval<4){Alertek.Start(orderTxt.servicesError,'--error');setTimeout(function tryAgain(){that.services(delivery);},4500);}else{location.reload();}};this.initEvents=()=>{this.vars.paymentsLabel.forEach((el)=>{el.addEventListener('click',function paymentsLabelClick(e){e.preventDefault();const paymentsGroup=this.parentNode;const paymentsContent=paymentsGroup.querySelector('.order__payments_content');const selectedInput=paymentsGroup.querySelector('.order__radio_payments');const selectedInpuChecked=document.querySelector('.order__radio_payments:checked');const payformInput=paymentsGroup.querySelector('input[name="payform_id"]');const paymentsContentEl=paymentsGroup.querySelector('.order__payment');if(paymentsGroup.getAttribute('id')==='single_group_190'){that.giftCardDialog('gift');}else if(paymentsGroup.getAttribute('id')==='single_group_2'){that.giftCardDialog('voucher');}
if(paymentsContent){if(paymentsGroup.getAttribute('id')==='card_payment'&&paymentsGroup.getAttribute('system-id')==='29'){paymentsContentEl.dispatchEvent(new Event("click"));}else{paymentsGroup.getAttribute('data-open')==='true'?paymentsGroup.setAttribute('data-open','false'):paymentsGroup.setAttribute('data-open','true');}}else if(selectedInput!==selectedInpuChecked){selectedInput.checked=true;if(payformInput)payformInput.checked=true;if(paymentsGroup.getAttribute('id')==='dvp_payment'){that.changeDelivery(0);}else{that.changeDelivery(1);}}});});this.vars.paymentItems.forEach((el)=>{el.addEventListener('click',function paymentClick(e){e.preventDefault();const paymentsGroup=this.parentNode.parentNode;const selectedInput=paymentsGroup.querySelector('.order__radio_payments');const payformInput=this.querySelector('.order__radio');const payformInputChecked=document.querySelector('input[name="payform_id"]:checked');const currentGroup=document.querySelector('.order__radio_payments:checked')?document.querySelector('.order__radio_payments:checked').parentNode:false;const clickedPayformInput=this.querySelector('img');if(payformInput!==payformInputChecked){if(payformInput.getAttribute('id')==='payform_2'){that.giftCardDialog('voucher');}else if(payformInput.getAttribute('id')==='payform_190'){that.giftCardDialog('gift');}else{selectedInput.checked=true;payformInput.checked=true;if((paymentsGroup.getAttribute('id')==='transfer_payment'||paymentsGroup.getAttribute('id')==='card_payment')&&paymentsGroup.getAttribute('data-open')==='true'){if(paymentsGroup.querySelectorAll('.order__ingroup_payment_icon:not(:first-of-type)').length>0){for(var item of paymentsGroup.querySelectorAll('.order__ingroup_payment_icon:not(:first-of-type)')){item.remove();}}
paymentsGroup.querySelector('.order__payments_icons img').setAttribute('src',clickedPayformInput.getAttribute('src'));paymentsGroup.querySelector('.order__payments_icons img').setAttribute('alt',clickedPayformInput.getAttribute('alt'));}
if(currentGroup&&currentGroup.getAttribute('id')==='dvp_payment'){that.changeDelivery(1);}else{that.updateCost();}}}});});this.vars.deliveryGroup.forEach((el)=>{el.addEventListener('click',function deliveryGroupClick(e){e.preventDefault();const deliveryInput=this.querySelector('.order__radio_delivery');const orderDelivery=deliveryInput.closest('.order__delivery');const deliveryInputChecked=orderDelivery.querySelector('.order__radio_delivery:checked');if(deliveryInput!==deliveryInputChecked&&!deliveryInput.disabled){deliveryInput.checked=true;that.pointsDelivery(orderDelivery.querySelectorAll('.order__points_label'));if(orderDelivery.querySelector('.order__xpress')){orderDelivery.querySelector('.order__xpress').classList.remove('--active');orderDelivery.querySelector('.order__xpress_choice').classList.remove('--active');orderDelivery.querySelector('.order__xpress_choice').innerHTML=that.vars.xpressGroupBase;orderDelivery.querySelector('.order__xpress_not').classList.remove('--active');orderDelivery.querySelector('.order__time').classList.remove('--xpress');that.vars.summaryTimeBlock.classList.remove('--xpress');}
that.updateDelivery(this);if(!this.hasAttribute('data-services'))orderDelivery.querySelector('.order__calendar').classList.remove('--active');}});});this.vars.buttonSubmit.addEventListener('click',function buttonSubmitClick(e){e.preventDefault();const orderDelivery=document.querySelectorAll('.order__delivery');let xpressTmp=true;orderDelivery.forEach((delivery)=>{const deliveryChecked=delivery.querySelector('.order__radio_delivery:checked').parentNode;const xpressInputChecked=delivery.querySelector('.order__xpress_radio:checked');if(deliveryChecked.hasAttribute('data-sameday')&&!xpressInputChecked){Alertek.show_alert(orderTxt.xpress1);xpressTmp=false;return false;}});if(xpressTmp){that.vars.orderForm.submit();}
return true;});this.vars.calendarButton.forEach((el)=>{el.addEventListener('click',function calendarButtonClick(e){e.preventDefault();this.closest('.order__delivery').querySelector('.order__calendar').classList.toggle('--active');});});this.vars.pointsLabel.forEach((el)=>{el.addEventListener('click',function pointsLabelClick(e){e.preventDefault();const pointsInput=this.parentNode.querySelector('.order__radio_points');const pointsInputChecked=this.closest('.order__delivery').querySelector('.order__radio_points:checked');if(pointsInput!==pointsInputChecked){pointsInput.checked=true;that.updateCost();}});});this.vars.xpressButton.forEach((el)=>{el.addEventListener('click',function xpressButtonClick(e){e.preventDefault();that.xpressCouriers();});});if(this.vars.insuranceInput){this.vars.insuranceInput.addEventListener('change',function insuranceInputClick(){that.updateCost();});}};this.init=()=>{this.initEvents();this.pointsDelivery(this.vars.pointsLabel);document.querySelectorAll('.order__radio_delivery:checked').forEach((delivery)=>this.updateDelivery(delivery.parentNode));document.querySelectorAll('.headline__division_time').forEach((headline)=>{const orderDelivery=headline.closest('.order__delivery');if(orderDelivery.classList.contains('--division')){const weeksTxt=[orderTxt.week3,orderTxt.week1,orderTxt.week2];const daysTxt=[orderTxt.days,orderTxt.day,orderTxt.days];const shippingDivisionTimeWeeks=headline.getAttribute('data-weeks');const shippingDivisionTimeDays=headline.getAttribute('data-days');const shippingDivisionTimeWeekDay=headline.getAttribute('data-week_day');const shippingDivisionTimeToday=headline.getAttribute('data-today');if(parseInt(shippingDivisionTimeWeeks,10)===0){document.querySelectorAll('.headline__division_literal').forEach((el)=>{el.style.display='none';});if(shippingDivisionTimeToday==='true'){headline.innerHTML=orderTxtShipping[0];}else{headline.innerHTML=orderTxtShipping[parseInt(shippingDivisionTimeWeekDay,10)];}}else{headline.innerHTML=that.changeLiteral(parseInt(shippingDivisionTimeDays,10),daysTxt,false);}}else{const shippingDivisionTime=headline.getAttribute('data-shipping_time');headline.innerHTML=orderTxtShipping[shippingDivisionTime];}});};return this.init();};app_shop.run(function OrderRun(){app_shop.fn.order=new Order();},'all','.order');